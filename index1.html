<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Game EVAS - Back to School</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; margin: 20px; }
    .hidden { display: none; }
    iframe { width: 100%; height: 500px; border: none; margin-top: 15px; }
    .form-box, .game-box { max-width: 600px; margin: auto; }
    button { padding: 10px 20px; font-size: 16px; cursor: pointer; margin-top: 15px; }
  </style>
</head>
<body>

  <h2>🎮 Trò chơi Back to School – EVAS 🎮</h2>

  <!-- Bước 1: Form thông tin -->
  <div class="form-box" id="infoForm">
    <p>Vui lòng nhập thông tin để tham gia trò chơi:</p>
    <form id="playerForm">
      <label>Họ tên: </label><br>
      <input type="text" id="name" required><br><br>

      <label>Số điện thoại: </label><br>
      <input type="text" id="phone" required><br><br>

      <button type="submit">Bắt đầu chơi</button>
    </form>
  </div>

  <!-- Bước 2: Game + bộ đếm thời gian -->
  <div class="game-box hidden" id="gameBox">
    <h3>⏱ Thời gian: <span id="timer">0</span> giây</h3>
    
    <!-- Nhúng game Genially -->
    <iframe src="https://view.genially.com/68a552f12c3917c9edc07c33/interactive-content-nong-trai-evas" allowfullscreen></iframe>

    <!-- Nút kết thúc -->
    <button onclick="finishGame()">Hoàn thành trò chơi</button>
  </div>

  <script>
    let startTime, timerInterval;
    let playerName = "", playerPhone = "";

    // Khi phụ huynh nhập form
    document.getElementById("playerForm").addEventListener("submit", function(e) {
      e.preventDefault();
      playerName = document.getElementById("name").value;
      playerPhone = document.getElementById("phone").value;

      // Ẩn form, hiện game
      document.getElementById("infoForm").classList.add("hidden");
      document.getElementById("gameBox").classList.remove("hidden");

      // Bắt đầu đếm giờ
      startTime = Date.now();
      timerInterval = setInterval(() => {
        let elapsed = Math.floor((Date.now() - startTime) / 1000);
        document.getElementById("timer").innerText = elapsed;
      }, 1000);
    });

    // Khi bấm Hoàn thành
    function finishGame() {
      clearInterval(timerInterval);
      let totalTime = Math.floor((Date.now() - startTime) / 1000);

      // Gửi kết quả vào Google Form
      const formURL = "https://docs.google.com/forms/d/102zpNh8hxB1-ugy4YEovdRlt6gwxcVuo3nDNtSYq2jI/formResponse"; 
      const data = new FormData();
      data.append("entry.1485467691", playerName); // entry ID của trường Họ tên
      data.append("entry.7245706", playerPhone); // entry ID của trường SĐT
      data.append("entry.1870645037", totalTime);   // entry ID của trường Thời gian

      fetch(formURL, {
        method: "POST",
        body: data,
        mode: "no-cors"
      }).then(() => {
        alert("🎉 Bạn đã hoàn thành trò chơi trong " + totalTime + " giây!\nKết quả đã được lưu lại.");
        location.reload(); // reset để chơi lại
      });
    }
  </script>

</body>
</html>


